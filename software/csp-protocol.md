---
layout: default
---

# Client-Server-Pi Protocol

## Secrets

To allow the server to identify clients and the robot, common secrets are used. The list of secrets used are as follows:

| Secret | Purpose |
|-|-|
| SERVER_ROBOT_SECRET | Common secret between the server and robot |
| SERVER_CLIENT_SECRET | Common secret between the server and observer |
| SERVER_OPERATOR_SECRET | Common secret between the server and operator |

## Access Request

For both clients and robots, an acccess request would need to be made to the server before the clients are allowed to communicate to the Socket.IO server. This would be done through a POST request at /access, which would include 2 parameters: 'secret' and 'guid'. 'secret' is the shared secret seen above, and 'guid' would be a GUID that is generated by the client to identify itself. If the request is successful, a JSON object containing the GUID, access token and client type would be returned under 'guid', 'token' and 'type' respectively. 

If the parameters provided are invalid, the server would return an error code of 400; if there is already an existing client with the same GUID thatis online, an error code of 401 would be returned; and if an error occurred while processing the request, the error would be logged in the server and the client would receive an error code of 500.

## Socket.IO Authentication

To authentice when connecting to the Socket.IO server, 2 parameters should be included in either the query or the header of the Socket.IO request. The 2 parameters are the GUID and access token, as 'guid' and 'token' respectively. Once a client successfully authenticates with the server, the server would automatically assign the client to a room based on its type, and send a test Socket.IO signal to the client which would be covered below.

## Socket.IO Signals

The following is a list of signals that are used by the client, server and Pi:

| Signal | From | To | Purpose | Contents |
|-|-|-|-|-|
| testRobot | Server | Robot | Test signal on initial connection | - |
| testClient | Server | Observer | Test signal on initial connection | - |
| testOperator | Server | Operator | Test signal on initial connection | - |
| operatorRotateCamera | Operator | Server | Rotate camera of robot | JSON object containing angle that camera should rotate in radians (parameter 'data') |
| operatorRotate | Operator | Server | Rotate robot | JSON object containing angle that robot should rotate in radians (parameter 'data') |
| operatorStartMoving | Operator | Server | Start moving | - |
| operatorStopMoving | Operator | Server | Stop moving | - |
| operatorChangeSpeed | Operator | Server | Change the speed of the robot | JSON object containing targeted speed as either 1, 2 or 3 (parameter 'data') |
| robotRotateCamera | Server | Robot | Rotate camera of robot | JSON object containing angle that camera should rotate in radians (parameter 'data') |
| robotRotate | Server | Robot | Rotate robot | JSON object containing angle that robot should rotate in radians (parameter 'data') |
| robotStartMoving | Server | Robot | Start moving | - |
| robotStopMoving | Server | Robot | Stop moving | - |
| robotChangeSpeed | Server | Robot | Change the speed of the robot | JSON object containing targeted speed as either 1, 2 or 3 (parameter 'data') |
| robotUpdateData | Robot | Server | Send sensory data to clients | JSON object containing raw sensory data from Arduino (see [Pi-Arduino protocol](./pa-protocol) |
| robotSendVideo | Robot | Server | Send footage to clients | 1 frame of image data from robot as MJPEG |
| clientUpdateData | Server | Operator + Observer | Send sensory data to clients | JSON object containing raw sensory data from Arduino (see [Pi-Arduino protocol](./pa-protocol) |
| clientSendVideo | Server | Operator + Observer | Send footage to clients | 1 frame of image data from robot as MJPEG |
